<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Music Player">
    <link rel="apple-touch-icon" sizes="180x180" href="icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon.png">
    
    <title>Lecteur de Musique</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .spinning {
            animation: spin 3s linear infinite;
        }

        .visually-hidden {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Play = () => (
            <svg width="28" height="28" viewBox="0 0 24 24" fill="white" stroke="white" strokeWidth="2">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        const Pause = () => (
            <svg width="28" height="28" viewBox="0 0 24 24" fill="white" stroke="white" strokeWidth="2">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        );

        const SkipBack = ({size = 32}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2">
                <polygon points="19 20 9 12 19 4 19 20"></polygon>
                <line x1="5" y1="19" x2="5" y2="5"></line>
            </svg>
        );

        const SkipForward = ({size = 32}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2">
                <polygon points="5 4 15 12 5 20 5 4"></polygon>
                <line x1="19" y1="5" x2="19" y2="19"></line>
            </svg>
        );

        const Volume2 = ({size = 20}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
        );

        const Heart = ({size = 24, filled = false}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
        );

        const Shuffle = ({size = 20}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="16 3 21 3 21 8"></polyline>
                <line x1="4" y1="20" x2="21" y2="3"></line>
                <polyline points="21 16 21 21 16 21"></polyline>
                <line x1="15" y1="15" x2="21" y2="21"></line>
                <line x1="4" y1="4" x2="9" y2="9"></line>
            </svg>
        );

        const Repeat = ({size = 20}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="17 1 21 5 17 9"></polyline>
                <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                <polyline points="7 23 3 19 7 15"></polyline>
                <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
            </svg>
        );

        const Upload = ({size = 24}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const Trash = ({size = 16}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const MusicPlayer = () => {
            const [isPlaying, setIsPlaying] = useState(false);
            const [currentTime, setCurrentTime] = useState(0);
            const [duration, setDuration] = useState(0);
            const [volume, setVolume] = useState(70);
            const [currentTrack, setCurrentTrack] = useState(0);
            const [likedTracks, setLikedTracks] = useState([]);
            const [shuffle, setShuffle] = useState(false);
            const [repeat, setRepeat] = useState(false);
            const [playlist, setPlaylist] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            
            const audioRef = useRef(null);
            const fileInputRef = useRef(null);
            const playlistInputRef = useRef(null);

            useEffect(() => {
                loadPlaylistFromStorage();
            }, []);

            useEffect(() => {
                if (!isLoading && playlist.length > 0) {
                    savePlaylistToStorage();
                }
            }, [playlist, isLoading]);

            const savePlaylistToStorage = async () => {
                try {
                    const playlistMeta = playlist.map(track => ({
                        id: track.id,
                        title: track.title,
                        artist: track.artist,
                        fileName: track.file.name
                    }));
                    
                    localStorage.setItem('playlist-meta', JSON.stringify(playlistMeta));
                    
                    for (const track of playlist) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            localStorage.setItem(`audio-${track.id}`, e.target.result);
                        };
                        reader.readAsDataURL(track.file);
                    }
                    console.log('Sauvegarde réussie:', playlist.length, 'chansons');
                } catch (error) {
                    console.log('Erreur de sauvegarde:', error);
                }
            };

            const loadPlaylistFromStorage = async () => {
                try {
                    const metaJson = localStorage.getItem('playlist-meta');
                    if (!metaJson) {
                        console.log('Aucune playlist sauvegardée');
                        setIsLoading(false);
                        return;
                    }
                    
                    const playlistMeta = JSON.parse(metaJson);
                    const loadedTracks = [];
                    
                    for (const meta of playlistMeta) {
                        try {
                            const audioData = localStorage.getItem(`audio-${meta.id}`);
                            if (audioData) {
                                const response = await fetch(audioData);
                                const blob = await response.blob();
                                const file = new File([blob], meta.fileName, { type: 'audio/mpeg' });
                                
                                loadedTracks.push({
                                    id: meta.id,
                                    title: meta.title,
                                    artist: meta.artist,
                                    url: audioData,
                                    file: file
                                });
                            }
                        } catch (err) {
                            console.log('Erreur chargement piste:', err);
                        }
                    }
                    
                    if (loadedTracks.length > 0) {
                        console.log('Chargé:', loadedTracks.length, 'chansons');
                        setPlaylist(loadedTracks);
                    }
                } catch (error) {
                    console.log('Erreur de chargement:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            useEffect(() => {
                if (audioRef.current) {
                    audioRef.current.volume = volume / 100;
                }
            }, [volume]);

            useEffect(() => {
                if (audioRef.current && playlist.length > 0) {
                    audioRef.current.src = playlist[currentTrack].url;
                    audioRef.current.load();
                    if (isPlaying) {
                        audioRef.current.play().catch(err => {
                            console.log("Erreur de lecture:", err);
                            setIsPlaying(false);
                        });
                    }
                }
            }, [currentTrack, playlist]);

            const handleFileSelect = (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;
                
                const newTracks = files.map((file, index) => ({
                    id: Date.now() + index,
                    title: file.name.replace(/\.[^/.]+$/, ""),
                    artist: "Artiste Inconnu",
                    url: URL.createObjectURL(file),
                    file: file
                }));
                
                setPlaylist(prev => [...prev, ...newTracks]);
                
                if (playlist.length === 0 && newTracks.length > 0) {
                    setCurrentTrack(0);
                }
            };

            const removeTrack = async (trackId) => {
                try {
                    localStorage.removeItem(`audio-${trackId}`);
                    setPlaylist(prev => {
                        const newPlaylist = prev.filter(track => track.id !== trackId);
                        if (newPlaylist.length === 0) {
                            localStorage.removeItem('playlist-meta');
                        }
                        return newPlaylist;
                    });
                    
                    if (currentTrack >= playlist.length - 1) {
                        setCurrentTrack(Math.max(0, playlist.length - 2));
                    }
                    console.log('Chanson supprimée');
                } catch (error) {
                    console.log('Erreur suppression:', error);
                }
            };

            const togglePlay = () => {
                if (playlist.length === 0) return;
                
                if (isPlaying) {
                    audioRef.current.pause();
                    setIsPlaying(false);
                } else {
                    audioRef.current.play().then(() => {
                        setIsPlaying(true);
                    }).catch(err => {
                        console.log("Erreur de lecture:", err);
                        setIsPlaying(false);
                    });
                }
            };
            
            const handleNext = () => {
                if (playlist.length === 0) return;
                let nextTrack;
                if (shuffle) {
                    nextTrack = Math.floor(Math.random() * playlist.length);
                } else {
                    nextTrack = (currentTrack + 1) % playlist.length;
                }
                setCurrentTrack(nextTrack);
                setIsPlaying(true);
            };
            
            const handlePrev = () => {
                if (playlist.length === 0) return;
                if (currentTime > 3) {
                    audioRef.current.currentTime = 0;
                } else {
                    const prevTrack = (currentTrack - 1 + playlist.length) % playlist.length;
                    setCurrentTrack(prevTrack);
                }
            };

            const handleTimeUpdate = () => {
                if (audioRef.current) {
                    setCurrentTime(audioRef.current.currentTime);
                    setDuration(audioRef.current.duration || 0);
                }
            };

            const handleEnded = () => {
                if (repeat) {
                    audioRef.current.currentTime = 0;
                    audioRef.current.play();
                } else {
                    handleNext();
                }
            };

            const handleSeek = (e) => {
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percentage = x / rect.width;
                const newTime = percentage * duration;
                if (audioRef.current) {
                    audioRef.current.currentTime = newTime;
                    setCurrentTime(newTime);
                }
            };

            const toggleLike = () => {
                if (playlist.length === 0) return;
                const trackId = playlist[currentTrack].id;
                if (likedTracks.includes(trackId)) {
                    setLikedTracks(likedTracks.filter(id => id !== trackId));
                } else {
                    setLikedTracks([...likedTracks, trackId]);
                }
            };

            const formatTime = (seconds) => {
                if (!seconds || isNaN(seconds)) return "0:00";
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const progress = duration > 0 ? (currentTime / duration) * 100 : 0;
            const currentTrackData = playlist[currentTrack];
            const isLiked = currentTrackData && likedTracks.includes(currentTrackData.id);

            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center">
                        <div className="text-center">
                            <div className="w-16 h-16 border-4 border-teal-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                            <p className="text-white text-lg">Chargement...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4">
                    <audio 
                        ref={audioRef}
                        onTimeUpdate={handleTimeUpdate}
                        onEnded={handleEnded}
                        onLoadedMetadata={handleTimeUpdate}
                    />
                    
                    <input 
                        ref={fileInputRef}
                        type="file" 
                        accept="audio/mp3,audio/mpeg,audio/wav,audio/m4a" 
                        multiple 
                        onChange={handleFileSelect}
                        className="visually-hidden"
                        id="mainFileInput"
                    />
                    <input 
                        ref={playlistInputRef}
                        type="file" 
                        accept="audio/mp3,audio/mpeg,audio/wav,audio/m4a" 
                        multiple 
                        onChange={handleFileSelect}
                        className="visually-hidden"
                        id="playlistFileInput"
                    />
                    
                    <div className="w-full max-w-md">
                        <div className="text-center mb-6">
                            <div className="inline-flex items-center gap-3 bg-gray-800/50 backdrop-blur-sm px-6 py-3 rounded-full">
                                <div className="w-10 h-10 bg-gradient-to-br from-teal-400 to-teal-500 rounded-full flex items-center justify-center">
                                    <span className="text-white font-bold text-xl">♪</span>
                                </div>
                                <div className="text-left">
                                    <div className="text-teal-400 font-bold text-lg leading-tight">MUSIC</div>
                                    <div className="text-gray-300 text-sm leading-tight">by Steff</div>
                                </div>
                            </div>
                        </div>
                        
                        <div className="mb-8 relative">
                            <div className="w-full aspect-square bg-gradient-to-br from-teal-400 via-teal-500 to-teal-600 rounded-3xl shadow-2xl flex items-center justify-center relative overflow-hidden">
                                <div className="absolute inset-0 bg-black opacity-20"></div>
                                {playlist.length === 0 ? (
                                    <label 
                                        htmlFor="mainFileInput"
                                        className="z-10 bg-white/20 backdrop-blur-sm px-8 py-4 rounded-2xl hover:bg-white/30 transition-all cursor-pointer flex flex-col items-center"
                                    >
                                        <Upload size={48} />
                                        <p className="text-white font-bold mt-2">Ajouter des musiques</p>
                                    </label>
                                ) : (
                                    <div className={`w-32 h-32 border-4 border-white rounded-full ${isPlaying ? 'spinning' : ''}`}>
                                        <div className="w-full h-full bg-gradient-to-br from-gray-700 to-gray-900 rounded-full flex items-center justify-center">
                                            <div className="w-8 h-8 bg-teal-400 rounded-full"></div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="text-center mb-6">
                            <h2 className="text-3xl font-bold text-white mb-2">
                                {currentTrackData ? currentTrackData.title : "Aucune musique"}
                            </h2>
                            <p className="text-teal-400 text-lg">
                                {currentTrackData ? currentTrackData.artist : "Ajoutez vos fichiers MP3"}
                            </p>
                        </div>

                        <div className="mb-2">
                            <div 
                                className="h-2 bg-gray-700 rounded-full overflow-hidden cursor-pointer" 
                                onClick={handleSeek}
                            >
                                <div 
                                    className="h-full bg-gradient-to-r from-teal-400 to-teal-500 transition-all duration-300 relative"
                                    style={{ width: `${progress}%` }}
                                >
                                    <div className="absolute right-0 top-1/2 transform -translate-y-1/2 w-4 h-4 bg-white rounded-full shadow-lg"></div>
                                </div>
                            </div>
                            <div className="flex justify-between text-sm text-gray-400 mt-1">
                                <span>{formatTime(currentTime)}</span>
                                <span>{formatTime(duration)}</span>
                            </div>
                        </div>

                        <div className="flex items-center justify-center gap-6 mb-6">
                            <button 
                                onClick={() => setShuffle(!shuffle)}
                                className={`${shuffle ? 'text-teal-400' : 'text-gray-400'} hover:text-teal-300 transition-colors`}
                            >
                                <Shuffle size={20} />
                            </button>
                            
                            <button 
                                onClick={handlePrev}
                                className="text-gray-300 hover:text-white transition-colors disabled:opacity-30"
                                disabled={playlist.length === 0}
                            >
                                <SkipBack size={32} />
                            </button>
                            
                            <button 
                                onClick={togglePlay}
                                className="w-16 h-16 bg-gradient-to-br from-teal-400 to-teal-500 rounded-full flex items-center justify-center shadow-lg hover:shadow-teal-500/50 transition-all hover:scale-105 disabled:opacity-50"
                                disabled={playlist.length === 0}
                            >
                                {isPlaying ? <Pause /> : <Play />}
                            </button>
                            
                            <button 
                                onClick={handleNext}
                                className="text-gray-300 hover:text-white transition-colors disabled:opacity-30"
                                disabled={playlist.length === 0}
                            >
                                <SkipForward size={32} />
                            </button>
                            
                            <button 
                                onClick={() => setRepeat(!repeat)}
                                className={`${repeat ? 'text-teal-400' : 'text-gray-400'} hover:text-teal-300 transition-colors`}
                            >
                                <Repeat size={20} />
                            </button>
                        </div>

                        <div className="flex items-center justify-between bg-gray-800 rounded-2xl p-4">
                            <div className="flex items-center gap-3 flex-1">
                                <Volume2 size={20} />
                                <input 
                                    type="range" 
                                    min="0" 
                                    max="100" 
                                    value={volume}
                                    onChange={(e) => setVolume(e.target.value)}
                                    className="flex-1 h-1 bg-gray-700 rounded-full appearance-none cursor-pointer"
                                    style={{
                                        background: `linear-gradient(to right, rgb(45, 212, 191) 0%, rgb(45, 212, 191) ${volume}%, rgb(55, 65, 81) ${volume}%, rgb(55, 65, 81) 100%)`
                                    }}
                                />
                                <span className="text-gray-400 text-sm w-8">{volume}</span>
                            </div>
                            
                            <button 
                                onClick={toggleLike}
                                className="ml-4 transition-all hover:scale-110 disabled:opacity-30"
                                disabled={playlist.length === 0}
                            >
                                <Heart size={24} filled={isLiked} />
                            </button>
                        </div>

                        <div className="mt-6 bg-gray-800 rounded-2xl p-4">
                            <div className="flex justify-between items-center mb-3">
                                <h3 className="text-white font-semibold">Playlist ({playlist.length})</h3>
                                <label 
                                    htmlFor="playlistFileInput"
                                    className="text-teal-400 hover:text-teal-300 text-sm cursor-pointer flex items-center gap-2"
                                >
                                    <Upload size={16} />
                                    <span>Ajouter</span>
                                </label>
                            </div>
                            
                            {playlist.length === 0 ? (
                                <div className="text-center py-8 text-gray-400">
                                    <p>Aucune musique pour le moment</p>
                                    <p className="text-sm mt-2">Cliquez sur "Ajouter" pour importer vos MP3</p>
                                </div>
                            ) : (
                                <div className="space-y-2 max-h-64 overflow-y-auto">
                                    {playlist.map((track, index) => (
                                        <div 
                                            key={track.id}
                                            className={`p-3 rounded-xl transition-all ${
                                                index === currentTrack 
                                                    ? 'bg-gradient-to-r from-teal-500/20 to-teal-600/20 border border-teal-500/30' 
                                                    : 'bg-gray-700/50 hover:bg-gray-700'
                                            }`}
                                        >
                                            <div className="flex justify-between items-center">
                                                <div 
                                                    className="flex-1 min-w-0 cursor-pointer"
                                                    onClick={() => {
                                                        setCurrentTrack(index);
                                                        setIsPlaying(true);
                                                    }}
                                                >
                                                    <p className={`font-medium truncate ${index === currentTrack ? 'text-teal-400' : 'text-white'}`}>
                                                        {track.title}
                                                    </p>
                                                    <p className="text-gray-400 text-sm">{track.artist}</p>
                                                </div>
                                                <div className="flex items-center gap-2 ml-2">
                                                    {likedTracks.includes(track.id) && (
                                                        <Heart size={16} filled={true} />
                                                    )}
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            removeTrack(track.id);
                                                        }}
                                                        className="text-gray-400 hover:text-red-400 transition-colors p-1"
                                                        title="Supprimer"
                                                    >
                                                        <Trash size={16} />
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<MusicPlayer />, document.getElementById('root'));
    </script>
</body>
</html>








